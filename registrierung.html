<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kleiderspenden-Registrierung</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <header>
      <img
        src="/Bilder/logo-kleiderherz-spenden-teilen.png.png"
        alt="Kleiderherz Logo"
      />
      <h1>Kleiderspendenportal</h1>
      <input type="checkbox" id="menu-toggle" />
      <label for="menu-toggle" class="menu-icon">&#9776;</label>
      <nav>
        <ul>
          <li><a href="index.html">Startseite</a></li>
          <li><a href="registrierung.html">Registrierung</a></li>
          <li><a href="spendenübersicht.html">Spendenübersicht</a></li>
          <li><a href="kontakt.html">Kontakt</a></li>
        </ul>
      </nav>
    </header>

    <form
      id="Spendenformular"
      class="col-lg-6 col-sm-12 p-4 border rounded shadow-sm"
    >
      <h2>Registriere Deine Kleiderspende</h2>
      <h3 class="mb-3">Übergabeart wählen:</h3>

      <div class="mb-3">
        <input
          type="radio"
          id="abholung"
          name="uebergabeart"
          value="abholung"
          required
        />
        <label for="abholung">Abholung durch Sammelfahrzeug</label><br />
      </div>
      <div class="mb-3">
        <input
          type="radio"
          id="geschaeftsstelle"
          name="uebergabeart"
          value="geschaeftsstelle"
        />
        <label for="geschaeftsstelle"
          >Persönliche Übergabe an der Geschäftsstelle</label
        ><br />
      </div>

      <div class="mb-3">
        <label for="krisengebiet">Krisengebiet auswählen:</label>
        <select id="krisengebiet" name="krisengebiet" required>
          <option value="">--Bitte wählen--</option>
          <option value="ukraine">Ukraine</option>
          <option value="gaza">Gaza</option>
          <option value="afghanistan">Afghanistan</option>
          <option value="andere">Anderes Krisengebiet</option>
        </select>
      </div>

      <div class="mb-4">
        <label for="kleidungsart">Art der Kleidung:</label>
        <select id="kleidungsart" name="kleidungsart" required>
          <option value="">--Bitte wählen--</option>
          <option value="hose">Hose</option>
          <option value="schuhe">Schuhe</option>
          <option value="jacke">Jacke</option>
          <option value="andere">Andere Artikel</option>
        </select>
      </div>

      <div id="abholadresse" style="display: none">
        <label for="plz">Postleitzahl (PLZ):</label>
        <input
          type="text"
          id="plz"
          name="plz"
          maxlength="5"
          pattern="\d{5}"
          required
        /><br />
      </div>

      <div class="mb-3">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required />
      </div>

      <div class="mb-3">
        <label for="email">E-Mail:</label>
        <input type="email" id="email" name="email" required />
      </div>

      <button class="button w-100" type="submit">Spende registrieren</button>
    </form>

    <footer>
      <nav>
        <ul>
          <li><a href="impressum.html">Impressum</a></li>
          <li><a href="datenschutz.html">Datenschutz</a></li>
        </ul>
      </nav>
      <p>&copy; 2025 Kleiderherz. Alle Rechte vorbehalten.</p>
    </footer>

    <script>
      const spendenFormular = document.getElementById("Spendenformular");
      const abholungRadio = document.getElementById("abholung");
      const geschaeftsstelleRadio = document.getElementById("geschaeftsstelle");
      const abholadresseDiv = document.getElementById("abholadresse");
      const plzInput = document.getElementById("plz");
      const GESCHAEFTSSTELLE_PRUEF_PREFIX = "20";

      function aktualisiereAdressenanzeige() {
        if (abholungRadio.checked) {
          abholadresseDiv.style.display = "block";
          plzInput.setAttribute("required", "required");
        } else {
          abholadresseDiv.style.display = "none";
          plzInput.removeAttribute("required");
          plzInput.value = "";
        }
      }

      abholungRadio.addEventListener("change", aktualisiereAdressenanzeige);
      geschaeftsstelleRadio.addEventListener(
        "change",
        aktualisiereAdressenanzeige
      );
      aktualisiereAdressenanzeige();

      spendenFormular.onsubmit = function (event) {
        event.preventDefault();

        if (abholungRadio.checked) {
          const plz = plzInput.value.trim();
          const userPrefix = plz.substring(0, 2);

          if (userPrefix !== GESCHAEFTSSTELLE_PRUEF_PREFIX) {
            alert(
              `Abholungen sind nur in der Nähe der Geschäftsstelle möglich. Die ersten beiden PLZ-Ziffern müssen mit ${GESCHAEFTSSTELLE_PRUEF_PREFIX} übereinstimmen.`
            );

            return false;
          }
        }

        //Wenn Validierung erfolgreich ist:
        verarbeiteDatenUndLeiteWeiter();
      };

      function verarbeiteDatenUndLeiteWeiter() {
        const kleidungsart =
          document.getElementById("kleidungsart").options[
            document.getElementById("kleidungsart").selectedIndex
          ].text;
        const krisengebiet =
          document.getElementById("krisengebiet").options[
            document.getElementById("krisengebiet").selectedIndex
          ].text;

        const finalerOrt = abholungRadio.checked
          ? plzInput.value.trim()
          : "Geschäftsstelle Kleiderherz";

        const aktuellesDatum = new Date();
        const datum = aktuellesDatum.toLocaleDateString("de-DE");
        const uhrzeit = aktuellesDatum.toLocaleTimeString("de-DE");

        const parameter = new URLSearchParams({
          kleidungsart: kleidungsart,
          krisengebiet: krisengebiet,
          ort: finalerOrt,
          datum: datum,
          uhrzeit: uhrzeit,
        }).toString();

        window.location.href = `registrierung_erfolgreich.html?${parameter}`;
      }
    </script>
  </body>
</html>
